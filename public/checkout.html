<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Thanh toán - TimeLuxe</title>
    <link rel="stylesheet" href="css/styles.css">
    <link rel="stylesheet" href="css/header.css">
    <link rel="stylesheet" href="css/responsive.css">
    

    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        /* Custom Notification System */
        .custom-notification {
            position: fixed;
            top: 20px;
            right: 20px;
            background: #fff;
            border-radius: 12px;
            box-shadow: 0 8px 32px rgba(0,0,0,0.15);
            padding: 16px 20px;
            z-index: 10000;
            transform: translateX(400px);
            transition: transform 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            max-width: 400px;
            border-left: 4px solid #4CAF50;
        }
        
        .custom-notification.show {
            transform: translateX(0);
        }
        
        .custom-notification.error {
            border-left-color: #f44336;
        }
        
        .custom-notification.warning {
            border-left-color: #ff9800;
        }
        
        .custom-notification.info {
            border-left-color: #2196F3;
        }
        
        .notification-content {
            display: flex;
            align-items: center;
            gap: 12px;
        }
        
        .notification-icon {
            font-size: 1.2rem;
            color: #4CAF50;
        }
        
        .custom-notification.error .notification-icon {
            color: #f44336;
        }
        
        .custom-notification.warning .notification-icon {
            color: #ff9800;
        }
        
        .custom-notification.info .notification-icon {
            color: #2196F3;
        }
        
        .notification-message {
            flex: 1;
            font-size: 0.95rem;
            color: #333;
            line-height: 1.4;
        }
        
        .notification-close {
            background: none;
            border: none;
            color: #999;
            cursor: pointer;
            font-size: 1.2rem;
            padding: 0;
            width: 24px;
            height: 24px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
            transition: all 0.2s ease;
        }
        
        .notification-close:hover {
            background: #f5f5f5;
            color: #666;
        }
        
        /* Checkout Styles */
        .checkout-container {
            max-width: 1200px;
            margin: 40px auto;
            padding: 0 20px;
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
            min-height: 100vh;
            box-sizing: border-box;
            min-width: 0;
            overflow-x: hidden;
        }
        
        .checkout-grid {
            display: grid;
            grid-template-columns: 1fr 300px;
            gap: 15px;
            margin-top: 15px;
            min-width: 0;
            width: 100%;
            box-sizing: border-box;
        }
        
        @media (max-width: 480px) {
            .checkout-grid {
                grid-template-columns: 1fr;
                gap: 15px;
                margin-top: 15px;
            }
        }
        
        .checkout-form {
            background: #fff;
            border-radius: 16px;
            box-shadow: 0 8px 32px rgba(0,0,0,0.1);
            padding: 20px;
            border: 1px solid rgba(255,255,255,0.2);
            max-width: 100%;
            box-sizing: border-box;
            width: 100%;
            overflow-x: hidden;
        }
        
        .checkout-form h2 {
            color: #2c3e50;
            margin-bottom: 20px;
            font-size: 1.6rem;
            font-weight: 700;
            position: relative;
            padding-bottom: 10px;
        }
        
        .checkout-form h2::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 0;
            width: 60px;
            height: 3px;
            background: linear-gradient(90deg, #7c6240, #e67e22);
            border-radius: 2px;
        }
        
        .form-group {
            margin-bottom: 16px;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 8px;
            color: #34495e;
            font-weight: 600;
            font-size: 0.95rem;
        }
        
        .form-group input, .form-group textarea, .form-group select {
            width: 100%;
            padding: 10px 12px;
            border: 2px solid #ecf0f1;
            border-radius: 8px;
            font-size: 1rem;
            transition: all 0.3s ease;
            background: #fafbfc;
            box-sizing: border-box;
            max-width: 100%;
            overflow-x: hidden;
        }
        
        .form-group input:focus, .form-group textarea:focus, .form-group select:focus {
            outline: none;
            border-color: #7c6240;
            background: #fff;
            box-shadow: 0 0 0 3px rgba(124, 98, 64, 0.1);
        }
        
        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 16px;
        }
        
        .order-summary {
            background: #fff;
            border-radius: 16px;
            box-shadow: 0 8px 32px rgba(0,0,0,0.1);
            padding: 16px;
            height: fit-content;
            position: sticky;
            top: 20px;
            border: 1px solid rgba(255,255,255,0.2);
            max-width: 100%;
            box-sizing: border-box;
            width: 100%;
            overflow-x: hidden;
        }
        
        @media (max-width: 480px) {
            .order-summary {
                position: static;
                margin-top: 15px;
            }
        }
        
        .order-summary h2 {
            color: #2c3e50;
            margin-bottom: 24px;
            font-size: 1.6rem;
            font-weight: 700;
            text-align: center;
        }
        
        .cart-items {
            margin-bottom: 24px;
            padding: 12px;
            width: 100%;
            box-sizing: border-box;
            overflow-x: hidden;
        }
        
        .cart-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 16px 0;
            border-bottom: 1px solid #e9ecef;
            width: 100%;
            box-sizing: border-box;
            overflow-x: hidden;
            flex-wrap: wrap;
            gap: 8px;
        }
        
        .item-image {
            flex-shrink: 0;
            margin-right: 12px;
            display: block;
        }
        
        .cart-item-img {
            width: 50px;
            height: 50px;
            object-fit: cover;
            border-radius: 8px;
            border: 1px solid #e9ecef;
            display: block;
            background-color: #f8f9fa;
        }
        
        .item-info {
            flex: 1;
            margin-right: 12px;
        }
        
        .cart-item-name {
            font-size: 0.85rem;
            word-wrap: break-word;
            overflow-wrap: break-word;
            max-width: 100%;
            hyphens: auto;
        }
        
        .cart-item-price {
            font-size: 0.85rem;
        }
        
        .discount-section {
            margin-bottom: 24px;
        }
        
        .discount-input-group {
            display: flex;
            gap: 8px;
            margin-bottom: 12px;
        }
        
        .discount-input {
            flex: 1;
            padding: 8px 10px;
            border: 2px solid #ecf0f1;
            border-radius: 6px;
            font-size: 0.85rem;
        }
        
        .apply-discount-btn {
            background: linear-gradient(135deg, #27ae60, #2ecc71);
            color: white;
            border: none;
            padding: 8px 12px;
            border-radius: 6px;
            font-size: 0.85rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 4px;
        }
        
        .apply-discount-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(39, 174, 96, 0.3);
        }
        
        .discount-message {
            font-size: 0.85rem;
            padding: 8px 12px;
            border-radius: 6px;
            margin-top: 8px;
            display: none;
        }
        
        .discount-message.success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        
        .discount-message.error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        
        .total-section {
            border-top: 2px solid #ecf0f1;
            padding-top: 20px;
        }
        
        .total-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 12px;
            font-size: 1rem;
        }
        
        .total-row.final {
            font-size: 1.2rem;
            font-weight: 700;
            color: #e74c3c;
            border-top: 2px solid #ecf0f1;
            padding-top: 12px;
            margin-top: 12px;
        }
        
        .checkout-btn {
            width: 100%;
            background: linear-gradient(135deg, #7c6240, #e67e22);
            color: white;
            border: none;
            padding: 16px 24px;
            border-radius: 12px;
            font-size: 1.1rem;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            margin-top: 20px;
        }
        
        .checkout-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(124, 98, 64, 0.3);
        }
        
        .payment-methods {
            margin-top: 24px;
        }
        
        .payment-method {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 12px 16px;
            border: 2px solid #ecf0f1;
            border-radius: 8px;
            margin-bottom: 12px;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .payment-method:hover {
            border-color: #7c6240;
            background: #f8f9fa;
        }
        
        .payment-method.selected {
            border-color: #7c6240;
            background: #f8f9fa;
        }
        
        .payment-method input[type="radio"] {
            margin: 0;
        }
        
        .payment-method label {
            margin: 0;
            cursor: pointer;
            font-weight: 500;
        }
        
        /* Responsive CSS */
        @media (max-width: 768px) {
            .checkout-container {
                margin: 20px auto;
                padding: 0 15px;
            }
            
            .checkout-form, .order-summary {
                padding: 18px;
            }
            
            .checkout-form h2 {
                font-size: 1.4rem;
                margin-bottom: 16px;
            }
            
            .form-group {
                margin-bottom: 14px;
            }
            
            .form-group label {
                font-size: 0.9rem;
                margin-bottom: 6px;
            }
            
            .form-group input, .form-group textarea, .form-group select {
                padding: 12px 14px;
                font-size: 0.9rem;
            }
            
            .form-row {
                grid-template-columns: 1fr;
                gap: 14px;
            }
            
            .order-summary h2 {
                font-size: 1.4rem;
                margin-bottom: 20px;
            }
            
            .cart-items {
                padding: 10px;
            }
            
            .cart-item {
                padding: 12px 0;
            }
            
            .cart-item-name {
                font-size: 0.8rem;
            }
            
            .cart-item-price {
                font-size: 0.8rem;
            }
            
            .total-row {
                font-size: 0.9rem;
            }
            
            .total-row.final {
                font-size: 1.1rem;
            }
            
            .checkout-btn {
                padding: 14px 20px;
                font-size: 1rem;
            }
        }
        
        @media (max-width: 480px) {
            .checkout-container {
                margin: 8px auto;
                padding: 0 5px;
                overflow-x: hidden;
                width: 100%;
                box-sizing: border-box;
                max-width: 100vw;
            }
            
            .checkout-form, .order-summary {
                padding: 12px;
                border-radius: 10px;
                max-width: 100%;
                box-sizing: border-box;
                width: 100%;
            }
            
            .checkout-form h2 {
                font-size: 1.3rem;
                margin-bottom: 16px;
            }
            
            .form-group {
                margin-bottom: 12px;
            }
            
            .form-group label {
                font-size: 0.9rem;
                margin-bottom: 6px;
            }
            
            .form-group input, .form-group textarea, .form-group select {
                padding: 8px 10px;
                font-size: 0.9rem;
                border-radius: 6px;
                max-width: 100%;
                box-sizing: border-box;
                width: 100%;
            }
            
            /* Form Fields Mobile Optimization */
            .form-group input:focus, .form-group textarea:focus, .form-group select:focus {
                border-color: #7c6240;
                box-shadow: 0 0 0 2px rgba(124, 98, 64, 0.1);
            }
            
            .form-group select {
                background-image: none;
                padding-right: 0.75rem;
                -webkit-appearance: none;
                -moz-appearance: none;
                appearance: none;
            }
            
            .form-group textarea {
                resize: vertical;
                min-height: 60px;
                width: 100% !important;
                max-width: 100% !important;
                box-sizing: border-box !important;
                overflow-x: hidden !important;
            }
            
            #address {
                width: 100% !important;
                max-width: 100% !important;
                box-sizing: border-box !important;
                overflow-x: hidden !important;
            }
            
            .order-summary h2 {
                font-size: 1.2rem;
                margin-bottom: 16px;
            }
            
            .cart-items {
                padding: 12px;
            }
            
            .cart-item {
                padding: 10px;
                margin-bottom: 10px;
            }
            
            .cart-item-name {
                font-size: 0.85rem;
                word-wrap: break-word;
                overflow-wrap: break-word;
                max-width: 100%;
            }
            
            .item-image {
                flex-shrink: 0;
                margin-right: 12px;
                display: block;
            }
            
            .cart-item-img {
                width: 50px;
                height: 50px;
                object-fit: cover;
                border-radius: 8px;
                border: 1px solid #e9ecef;
                display: block;
                background-color: #f8f9fa;
            }
            
            .item-info {
                flex: 1;
                margin-right: 12px;
            }
            
            .cart-item-price {
                font-size: 0.85rem;
            }
            
            .total-section {
                padding: 12px;
            }
            
            .total-row {
                font-size: 0.9rem;
            }
            
            .total-final {
                font-size: 1rem;
            }
            
            .payment-method {
                padding: 12px;
            }
            
            .payment-option {
                padding: 10px;
                margin-bottom: 8px;
            }
            
            .payment-option label {
                font-size: 0.85rem;
            }
        }
        
        /* Global overflow fix */
        body {
            overflow-x: hidden;
            width: 100%;
            max-width: 100vw;
        }
        
        /* Hide horizontal scrollbar */
        ::-webkit-scrollbar {
            width: 0px;
            background: transparent;
        }
        
        * {
            scrollbar-width: none;
        }
    </style>
</head>
<body>
    <header class="dhda-header">
        <!-- Top bar -->
        <div class="dhda-topbar">
            <div class="container dhda-topbar-flex">
                <div class="dhda-topbar-left">
                    <span class="dhda-hotline"><i class="fas fa-phone"></i> Hotline: <a href="tel:0834477085">0834477085</a></span>
                    <span class="dhda-address"><i class="fas fa-map-marker-alt"></i> 68 Nguyễn Chí Thanh, Hà Nội</span>
                </div>
                <div class="dhda-topbar-right">
                    <div id="guest-section" style="display: flex;">
                        <a href="login.html" class="dhda-login"><i class="fas fa-user"></i> Đăng nhập</a>
                    </div>
                    <div id="user-section" style="display: none; align-items: center; gap: 8px;">
                        <span>Xin chào, <span id="user-display-name"></span></span>
                        <a href="profile.html" style="color: #7c6240; margin-left: 8px;"><i class="fas fa-user"></i> Cá nhân</a>
                        <a href="#" id="logout-btn" style="color: #e53935; margin-left: 8px;">Đăng xuất</a>
                    </div>
                    <a href="#" class="dhda-cart"><i class="fas fa-shopping-cart"></i> Giỏ hàng <span class="cart-count">0</span></a>
                </div>
            </div>
        </div>
        <div class="dhda-header-main" style="background: #7c6240;">
            <div class="container dhda-header-main-flex" style="display: flex; flex-direction: row; align-items: center; justify-content: space-around; gap: 30px; padding: 15px 0;">
                <a href="index.html" class="dhda-logo">
                    <img src="images/logos/logo TIME LUXE.png" alt="TimeLuxe Logo" style="height: 120px; width: 120px; object-fit: contain;">
                </a>
                <!-- Menu ngang -->
                <nav class="dhda-menu" style="flex: 1; display: flex; justify-content: center; max-width: 700px;">
                    <ul class="dhda-menu-list" style="display: flex; gap: 25px; list-style: none; margin: 0; padding: 0; width: 100%; justify-content: space-evenly;">
                        <li><a href="index.html#brands" class="menu-link" style="color: #000000; text-decoration: none; font-weight: 600; font-size: 15px; padding: 10px 15px; display: block; transition: all 0.3s; border-radius: 5px;">THƯƠNG HIỆU</a></li>
                        <li><a href="donghotreotuong.html" class="menu-link" style="color: #000000; text-decoration: none; font-weight: 600; font-size: 15px; padding: 10px 15px; display: block; transition: all 0.3s; border-radius: 5px;">ĐỒNG HỒ TREO TƯỜNG</a></li>
                        <li><a href="daydongho.html" class="menu-link" style="color: #000000; text-decoration: none; font-weight: 600; font-size: 15px; padding: 10px 15px; display: block; transition: all 0.3s; border-radius: 5px;">DÂY ĐỒNG HỒ</a></li>
                        <li><a href="sanphamkhac.html" class="menu-link" style="color: #000000; text-decoration: none; font-weight: 600; font-size: 15px; padding: 10px 15px; display: block; transition: all 0.3s; border-radius: 5px;">SẢN PHẨM KHÁC</a></li>
                    </ul>
                </nav>
                <form class="dhda-search-bar" style="display: flex; min-width: 300px;" id="searchForm">
                    <input type="text" placeholder="Tìm kiếm sản phẩm, thương hiệu..." style="flex: 1;" id="searchInput">
                    <button type="submit"><i class="fas fa-search"></i></button>
                </form>
            </div>
        </div>
    </header>

    <div class="checkout-container">
        <div id="checkout-content">
            <!-- Nội dung sẽ được render bởi JavaScript -->
        </div>
    </div>

    <script src="js/footer.js"></script>

    <script src="js/index.js"></script>
    <script>
        function formatPrice(price) {
            return new Intl.NumberFormat('vi-VN', {
                style: 'currency',
                currency: 'VND'
            }).format(price);
        }

        function getCart() {
            return JSON.parse(localStorage.getItem('cart') || '[]');
        }

        function showNotification(message, type = 'success', duration = 3000) {
            const notification = document.createElement('div');
            notification.className = `custom-notification ${type}`;
            notification.innerHTML = `
                <div class="notification-content">
                    <i class="notification-icon fas fa-${type === 'success' ? 'check-circle' : type === 'error' ? 'exclamation-circle' : type === 'warning' ? 'exclamation-triangle' : 'info-circle'}"></i>
                    <span class="notification-message">${message}</span>
                    <button class="notification-close" onclick="this.parentElement.parentElement.remove()">×</button>
                </div>
            `;
            
            document.body.appendChild(notification);
            
            setTimeout(() => {
                notification.classList.add('show');
            }, 100);
            
            setTimeout(() => {
                notification.classList.remove('show');
                setTimeout(() => {
                    if (notification.parentElement) {
                        notification.remove();
                    }
                }, 400);
            }, duration);
        }

        // Biến lưu trữ thông tin discount code hiện tại
        let currentDiscountCode = null;
        
        // Hàm áp dụng mã giảm giá
        async function applyDiscountCode() {
            const discountInput = document.getElementById('discount-code');
            const applyBtn = document.getElementById('apply-discount-btn');
            const messageDiv = document.getElementById('discount-message');
            
            const code = discountInput.value.trim();
            if (!code) {
                showDiscountMessage('Vui lòng nhập mã giảm giá', 'error');
                return;
            }
            
            // Disable button và hiển thị loading
            applyBtn.disabled = true;
            applyBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Đang kiểm tra...';
            
            try {
                const cart = getCart();
                const subtotal = cart.reduce((sum, item) => sum + (item.price * item.quantity), 0);
                
                const response = await fetch('/api/validate-discount-code', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        code: code,
                        orderAmount: subtotal
                    })
                });
                
                const result = await response.json();
                
                if (result.valid) {
                    currentDiscountCode = result.discountCode;
                    showDiscountMessage(result.message, 'success');
                    updateOrderSummary();
                } else {
                    currentDiscountCode = null;
                    showDiscountMessage(result.message, 'error');
                    updateOrderSummary();
                }
                
            } catch (error) {
                console.error('Error validating discount code:', error);
                showDiscountMessage('Có lỗi xảy ra khi kiểm tra mã giảm giá', 'error');
            } finally {
                // Re-enable button
                applyBtn.disabled = false;
                applyBtn.innerHTML = '<i class="fas fa-tag"></i> Áp dụng';
            }
        }
        
        // Hàm hiển thị thông báo discount
        function showDiscountMessage(message, type) {
            const messageDiv = document.getElementById('discount-message');
            messageDiv.textContent = message;
            messageDiv.className = `discount-message ${type}`;
            messageDiv.style.display = 'block';
            
            // Tự động ẩn thông báo sau 5 giây
            setTimeout(() => {
                messageDiv.style.display = 'none';
            }, 5000);
        }
        
        // Hàm hiển thị checkout form
        function displayCheckoutForm() {
            const cart = getCart();
            const subtotal = cart.reduce((sum, item) => sum + (item.price * item.quantity), 0);
            const shipping = 50000;
            const total = subtotal + shipping;
            
            const checkoutContainer = document.getElementById('checkout-content');
            checkoutContainer.innerHTML = `
                <h1 style="color: #7c6240; margin-bottom: 30px;">Thanh toán</h1>
                <div class="checkout-grid">
                    <form id="checkout-form" class="checkout-form">
                        <h2>Thông tin giao hàng</h2>
                        <div class="form-row">
                            <div class="form-group">
                                <label for="fullName">Họ và tên *</label>
                                <input type="text" id="fullName" name="fullName" required>
                            </div>
                            <div class="form-group">
                                <label for="phone">Số điện thoại *</label>
                                <input type="tel" id="phone" name="phone" required>
                            </div>
                        </div>
                        <div class="form-group">
                            <label for="email">Email *</label>
                            <input type="email" id="email" name="email" required>
                        </div>
                        <div class="form-row">
                            <div class="form-group">
                                <label for="city">Tỉnh/Thành phố *</label>
                                <select id="city" name="city" required>
                                    <option value="">Chọn tỉnh/thành phố</option>
                                    <option value="An Giang">An Giang</option>
                                    <option value="Bà Rịa - Vũng Tàu">Bà Rịa - Vũng Tàu</option>
                                    <option value="Bắc Giang">Bắc Giang</option>
                                    <option value="Bắc Kạn">Bắc Kạn</option>
                                    <option value="Bạc Liêu">Bạc Liêu</option>
                                    <option value="Bắc Ninh">Bắc Ninh</option>
                                    <option value="Bến Tre">Bến Tre</option>
                                    <option value="Bình Định">Bình Định</option>
                                    <option value="Bình Dương">Bình Dương</option>
                                    <option value="Bình Phước">Bình Phước</option>
                                    <option value="Bình Thuận">Bình Thuận</option>
                                    <option value="Cà Mau">Cà Mau</option>
                                    <option value="Cần Thơ">Cần Thơ</option>
                                    <option value="Cao Bằng">Cao Bằng</option>
                                    <option value="Đắk Lắk">Đắk Lắk</option>
                                    <option value="Đắk Nông">Đắk Nông</option>
                                    <option value="Đà Nẵng">Đà Nẵng</option>
                                    <option value="Điện Biên">Điện Biên</option>
                                    <option value="Đồng Nai">Đồng Nai</option>
                                    <option value="Đồng Tháp">Đồng Tháp</option>
                                    <option value="Gia Lai">Gia Lai</option>
                                    <option value="Hà Giang">Hà Giang</option>
                                    <option value="Hải Dương">Hải Dương</option>
                                    <option value="Hải Phòng">Hải Phòng</option>
                                    <option value="Hà Nam">Hà Nam</option>
                                    <option value="Hà Nội">Hà Nội</option>
                                    <option value="Hà Tĩnh">Hà Tĩnh</option>
                                    <option value="Hậu Giang">Hậu Giang</option>
                                    <option value="TP. Hồ Chí Minh">TP. Hồ Chí Minh</option>
                                    <option value="Hòa Bình">Hòa Bình</option>
                                    <option value="Hưng Yên">Hưng Yên</option>
                                    <option value="Khánh Hòa">Khánh Hòa</option>
                                    <option value="Kiên Giang">Kiên Giang</option>
                                    <option value="Kon Tum">Kon Tum</option>
                                    <option value="Lai Châu">Lai Châu</option>
                                    <option value="Lâm Đồng">Lâm Đồng</option>
                                    <option value="Lạng Sơn">Lạng Sơn</option>
                                    <option value="Lào Cai">Lào Cai</option>
                                    <option value="Long An">Long An</option>
                                    <option value="Nam Định">Nam Định</option>
                                    <option value="Nghệ An">Nghệ An</option>
                                    <option value="Ninh Bình">Ninh Bình</option>
                                    <option value="Ninh Thuận">Ninh Thuận</option>
                                    <option value="Phú Thọ">Phú Thọ</option>
                                    <option value="Phú Yên">Phú Yên</option>
                                    <option value="Quảng Bình">Quảng Bình</option>
                                    <option value="Quảng Nam">Quảng Nam</option>
                                    <option value="Quảng Ngãi">Quảng Ngãi</option>
                                    <option value="Quảng Ninh">Quảng Ninh</option>
                                    <option value="Quảng Trị">Quảng Trị</option>
                                    <option value="Sóc Trăng">Sóc Trăng</option>
                                    <option value="Sơn La">Sơn La</option>
                                    <option value="Tây Ninh">Tây Ninh</option>
                                    <option value="Thái Bình">Thái Bình</option>
                                    <option value="Thái Nguyên">Thái Nguyên</option>
                                    <option value="Thanh Hóa">Thanh Hóa</option>
                                    <option value="Thừa Thiên Huế">Thừa Thiên Huế</option>
                                    <option value="Tiền Giang">Tiền Giang</option>
                                    <option value="Trà Vinh">Trà Vinh</option>
                                    <option value="Tuyên Quang">Tuyên Quang</option>
                                    <option value="Vĩnh Long">Vĩnh Long</option>
                                    <option value="Vĩnh Phúc">Vĩnh Phúc</option>
                                    <option value="Yên Bái">Yên Bái</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label for="district">Quận/Huyện *</label>
                                <select id="district" name="district" required>
                                    <option value="">Chọn quận/huyện</option>
                                </select>
                            </div>
                        </div>
                        <div class="form-group">
                            <label for="address">Địa chỉ giao hàng *</label>
                            <textarea id="address" name="address" rows="3" required></textarea>
                        </div>
                        <div class="form-group">
                            <label for="note">Ghi chú</label>
                            <textarea id="note" name="note" rows="2" placeholder="Ghi chú về đơn hàng (không bắt buộc)"></textarea>
                        </div>
                        
                        <h2>Phương thức thanh toán</h2>
                        <div class="payment-methods">
                            <div class="payment-method">
                                <input type="radio" id="cod" name="paymentMethod" value="cod" checked>
                                <label for="cod">Thanh toán khi nhận hàng (COD)</label>
                            </div>
                            <div class="payment-method">
                                <input type="radio" id="bank" name="paymentMethod" value="bank">
                                <label for="bank">Chuyển khoản ngân hàng</label>
                            </div>
                        </div>
                    </form>
                    
                    <div class="order-summary">
                        <h2>Đơn hàng của bạn</h2>
                        <div class="cart-items">
                            ${cart.map(item => `
                                <div class="cart-item">
                                    <div class="item-image">
                                        <img src="${item.image || '/static/dongho1.webp'}" alt="${item.name}" class="cart-item-img" onerror="this.src='/static/dongho1.webp'">
                                    </div>
                                    <div class="item-info">
                                        <div class="item-name">${item.name}</div>
                                        <div class="item-quantity">Số lượng: ${item.quantity}</div>
                                    </div>
                                    <div class="item-price">${formatPrice(item.price * item.quantity)}</div>
                                </div>
                            `).join('')}
                        </div>
                        
                        <div class="discount-section">
                            <div class="discount-input-group">
                                <input type="text" id="discount-code" placeholder="Nhập mã giảm giá" class="discount-input">
                                <button type="button" id="apply-discount-btn" class="apply-discount-btn">
                                    <i class="fas fa-tag"></i> Áp dụng
                                </button>
                            </div>
                            <div id="discount-message" class="discount-message"></div>
                        </div>
                        
                        <div class="total-section">
                            <div class="total-row">
                                <span>Tạm tính:</span>
                                <span>${formatPrice(subtotal)}</span>
                            </div>
                            <div class="total-row" id="discount-row" style="display: none;">
                                <span>Giảm giá:</span>
                                <span id="discount-amount" style="color: #27ae60;">-${formatPrice(0)}</span>
                            </div>
                            <div class="total-row">
                                <span>Phí vận chuyển:</span>
                                <span>${formatPrice(shipping)}</span>
                            </div>
                            <div class="total-row final">
                                <span>Tổng cộng:</span>
                                <span id="final-total">${formatPrice(total)}</span>
                            </div>
                        </div>
                        
                        <button class="checkout-btn" onclick="processCheckout()">
                            <i class="fas fa-credit-card"></i> Đặt hàng ngay
                        </button>
                    </div>
                </div>
            `;
            
            // Gắn sự kiện cho payment methods
            document.querySelectorAll('.payment-method').forEach(method => {
                method.addEventListener('click', function() {
                    document.querySelectorAll('.payment-method').forEach(m => m.classList.remove('selected'));
                    this.classList.add('selected');
                    const radio = this.querySelector('input[type="radio"]');
                    radio.checked = true;
                });
            });
            
            // Gắn sự kiện cho discount button
            document.getElementById('apply-discount-btn').addEventListener('click', applyDiscountCode);
        }
        
        // Hàm cập nhật order summary với discount
        function updateOrderSummary() {
            const cart = getCart();
            const subtotal = cart.reduce((sum, item) => sum + (item.price * item.quantity), 0);
            const shipping = 50000;
            
            let discountAmount = 0;
            if (currentDiscountCode) {
                discountAmount = currentDiscountCode.discount_amount;
            }
            
            const total = subtotal + shipping - discountAmount;
            
            // Cập nhật hiển thị
            const discountRow = document.getElementById('discount-row');
            const discountAmountSpan = document.getElementById('discount-amount');
            const finalTotalSpan = document.getElementById('final-total');
            
            if (currentDiscountCode && discountAmount > 0) {
                discountRow.style.display = 'flex';
                discountAmountSpan.textContent = `-${formatPrice(discountAmount)}`;
            } else {
                discountRow.style.display = 'none';
            }
            
            finalTotalSpan.textContent = formatPrice(total);
        }
        
        // Hàm xử lý checkout
        async function processCheckout() {
            const form = document.getElementById('checkout-form');
            const formData = new FormData(form);
            
            // Kiểm tra form
            if (!form.checkValidity()) {
                form.reportValidity();
                return;
            }
            
            const cart = getCart();
            if (cart.length === 0) {
                showNotification('Giỏ hàng trống!', 'warning');
                return;
            }
            
            // Kiểm tra đăng nhập
            const isLoggedIn = localStorage.getItem('isLoggedIn') === 'true';
            if (!isLoggedIn) {
                showNotification('Vui lòng đăng nhập để đặt hàng!', 'warning');
                setTimeout(() => {
                    window.location.href = 'login.html';
                }, 2000);
                return;
            }
            
            const subtotal = cart.reduce((sum, item) => sum + (item.price * item.quantity), 0);
            const shipping = 50000;
            const discountAmount = currentDiscountCode ? currentDiscountCode.discount_amount : 0;
            const total = subtotal + shipping - discountAmount;
            
            // Tạo địa chỉ đầy đủ
            const fullAddress = [
                formData.get('address') || '',
                formData.get('district') || '',
                formData.get('city') || ''
            ].filter(Boolean).join(', ');
            
            const orderData = {
                customer_name: formData.get('fullName') || '',
                customer_phone: formData.get('phone') || '',
                customer_email: formData.get('email') || '',
                customer_address: formData.get('address') || '',
                customer_city: formData.get('city') || '',
                customer_district: formData.get('district') || '',
                customer_note: formData.get('note') || '',
                payment_method: formData.get('paymentMethod') || 'cod',
                items: cart.map(item => ({
                    product_id: item.id,
                    quantity: item.quantity,
                    price: item.price
                })),
                total_amount: total,
                shipping_address: fullAddress,
                discount_code: currentDiscountCode ? currentDiscountCode.code : null,
                discount_amount: discountAmount
            };
            
            // Check payment method
            const paymentMethod = formData.get('paymentMethod') || 'cod';
            
            if (paymentMethod === 'bank') {
                // Lưu thông tin đơn hàng vào localStorage và chuyển đến trang thanh toán
                localStorage.setItem('pendingOrder', JSON.stringify(orderData));
                window.location.href = 'payment.html';
            } else {
                // Xử lý đặt hàng trực tiếp cho COD và MoMo
                try {
                    const response = await fetch('/api/orders', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                            'Authorization': `Bearer ${localStorage.getItem('token')}`
                        },
                        body: JSON.stringify(orderData)
                    });
                    
                    const result = await response.json();
                    
                    if (response.ok) {
                        // Xóa giỏ hàng
                        localStorage.removeItem('cart');
                        updateCartCount();
                        
                        // Hiển thị thông báo thành công
                        showNotification(`Đặt hàng thành công! Mã đơn hàng: ${result.orderId}`, 'success');
                        
                        // Chuyển về trang chủ sau 2 giây
                        setTimeout(() => {
                            window.location.href = 'index.html';
                        }, 2000);
                    } else {
                        showNotification(result.error || 'Có lỗi xảy ra khi đặt hàng!', 'error');
                    }
                } catch (error) {
                    console.error('Error processing checkout:', error);
                    showNotification('Có lỗi xảy ra khi đặt hàng!', 'error');
                }
            }
        }
        
        // Dữ liệu tỉnh thành và quận huyện
        const provincesData = {
            'Hà Nội': [
                'Ba Đình', 'Hoàn Kiếm', 'Tây Hồ', 'Long Biên', 'Cầu Giấy', 'Đống Đa', 'Hai Bà Trưng',
                'Hoàng Mai', 'Thanh Xuân', 'Sóc Sơn', 'Đông Anh', 'Gia Lâm', 'Nam Từ Liêm', 'Bắc Từ Liêm',
                'Phú Xuyên', 'Ứng Hòa', 'Mỹ Đức', 'Thường Tín', 'Phú Thọ', 'Ba Vì', 'Thạch Thất',
                'Quốc Oai', 'Chương Mỹ', 'Thanh Oai', 'Thạch Thất', 'Phúc Thọ', 'Đan Phượng', 'Hoài Đức'
            ],
            'TP. Hồ Chí Minh': [
                'Quận 1', 'Quận 2', 'Quận 3', 'Quận 4', 'Quận 5', 'Quận 6', 'Quận 7', 'Quận 8',
                'Quận 9', 'Quận 10', 'Quận 11', 'Quận 12', 'Tân Bình', 'Bình Tân', 'Tân Phú',
                'Phú Nhuận', 'Gò Vấp', 'Bình Thạnh', 'Thủ Đức', 'Củ Chi', 'Hóc Môn', 'Bình Chánh',
                'Nhà Bè', 'Cần Giờ'
            ],
            'Đà Nẵng': [
                'Hải Châu', 'Thanh Khê', 'Sơn Trà', 'Ngũ Hành Sơn', 'Liên Chiểu', 'Cẩm Lệ',
                'Hòa Vang', 'Hoàng Sa'
            ],
            'Hải Phòng': [
                'Hồng Bàng', 'Ngô Quyền', 'Lê Chân', 'Hải An', 'Kiến An', 'Đồ Sơn', 'Dương Kinh',
                'Thủy Nguyên', 'An Dương', 'An Lão', 'Kiến Thụy', 'Tiên Lãng', 'Vĩnh Bảo', 'Cát Hải',
                'Bạch Long Vĩ'
            ],
            'Cần Thơ': [
                'Ninh Kiều', 'Bình Thủy', 'Cái Răng', 'Ô Môn', 'Thốt Nốt', 'Vĩnh Thạnh',
                'Cờ Đỏ', 'Phong Điền', 'Thới Lai'
            ],
            'An Giang': [
                'TP. Long Xuyên', 'TP. Châu Đốc', 'Thị xã Tân Châu', 'An Phú', 'Châu Phú', 'Châu Thành',
                'Chợ Mới', 'Phú Tân', 'Tịnh Biên', 'Tri Tôn', 'Thoại Sơn'
            ],
            'bariavungtau': [
                'TP. Vũng Tàu', 'TP. Bà Rịa', 'Thị xã Phú Mỹ', 'Châu Đức', 'Côn Đảo', 'Đất Đỏ',
                'Long Điền', 'Tân Thành', 'Xuyên Mộc'
            ],
            'bacgiang': [
                'TP. Bắc Giang', 'Hiệp Hòa', 'Lạng Giang', 'Lục Nam', 'Lục Ngạn', 'Sơn Động',
                'Tân Yên', 'Việt Yên', 'Yên Dũng', 'Yên Thế'
            ],
            'backan': [
                'TP. Bắc Kạn', 'Ba Bể', 'Bạch Thông', 'Chợ Đồn', 'Chợ Mới', 'Na Rì', 'Ngân Sơn',
                'Pác Nặm'
            ],
            'baclieu': [
                'TP. Bạc Liêu', 'Đông Hải', 'Giá Rai', 'Hòa Bình', 'Hồng Dân', 'Phước Long',
                'Vĩnh Lợi'
            ],
            'bacninh': [
                'TP. Bắc Ninh', 'Thị xã Từ Sơn', 'Gia Bình', 'Lương Tài', 'Quế Võ', 'Thuận Thành',
                'Tiên Du', 'Yên Phong'
            ],
            'bentré': [
                'TP. Bến Tre', 'Ba Tri', 'Bình Đại', 'Châu Thành', 'Chợ Lách', 'Giồng Trôm',
                'Mỏ Cày Bắc', 'Mỏ Cày Nam', 'Thạnh Phú'
            ],
            'binhdinh': [
                'TP. Quy Nhơn', 'Thị xã An Nhơn', 'Thị xã Hoài Nhơn', 'An Lão', 'Hoài Ân', 'Phù Cát',
                'Phù Mỹ', 'Tây Sơn', 'Tuy Phước', 'Vân Canh', 'Vĩnh Thạnh'
            ],
            'binhduong': [
                'TP. Thủ Dầu Một', 'TP. Dĩ An', 'TP. Thuận An', 'Thị xã Bến Cát', 'Thị xã Tân Uyên',
                'Bàu Bàng', 'Bắc Tân Uyên', 'Dầu Tiếng', 'Phú Giáo'
            ],
            'binhphuoc': [
                'TP. Đồng Xoài', 'Thị xã Bình Long', 'Thị xã Phước Long', 'Bù Đăng', 'Bù Đốp',
                'Bù Gia Mập', 'Chơn Thành', 'Đồng Phú', 'Hớn Quản', 'Lộc Ninh', 'Phú Riềng'
            ],
            'binhthuan': [
                'TP. Phan Thiết', 'Thị xã La Gi', 'Bắc Bình', 'Đức Linh', 'Hàm Tân', 'Hàm Thuận Bắc',
                'Hàm Thuận Nam', 'Phú Quý', 'Tánh Linh', 'Tuy Phong'
            ],
            'camau': [
                'TP. Cà Mau', 'Cái Nước', 'Đầm Dơi', 'Năm Căn', 'Ngọc Hiển', 'Phú Tân', 'Thới Bình',
                'Trần Văn Thời', 'U Minh'
            ],
            'caobang': [
                'TP. Cao Bằng', 'Bảo Lạc', 'Bảo Lâm', 'Hạ Lang', 'Hà Quảng', 'Hoà An', 'Nguyên Bình',
                'Phục Hòa', 'Quảng Hòa', 'Thạch An', 'Thông Nông', 'Trà Lĩnh', 'Trùng Khánh'
            ],
            'daklak': [
                'TP. Buôn Ma Thuột', 'Thị xã Buôn Hồ', 'Buôn Đôn', 'Cư Kuin', 'Cư M\'gar', 'Ea H\'leo',
                'Ea Kar', 'Ea Súp', 'Krông Ana', 'Krông Bông', 'Krông Búk', 'Krông Năng', 'Krông Pắc',
                'Lắk', 'M\'Đrắk'
            ],
            'daknong': [
                'TP. Gia Nghĩa', 'Cư Jút', 'Đắk Glong', 'Đắk Mil', 'Đắk R\'lấp', 'Đắk Song',
                'Krông Nô', 'Tuy Đức'
            ],
            'dienbien': [
                'TP. Điện Biên Phủ', 'Thị xã Mường Lay', 'Điện Biên', 'Điện Biên Đông', 'Mường Ảng',
                'Mường Chà', 'Mường Nhé', 'Nậm Pồ', 'Tủa Chùa', 'Tuần Giáo'
            ],
            'dongnai': [
                'TP. Biên Hòa', 'TP. Long Khánh', 'Cẩm Mỹ', 'Định Quán', 'Long Thành', 'Nhơn Trạch',
                'Tân Phú', 'Thống Nhất', 'Trảng Bom', 'Vĩnh Cửu', 'Xuân Lộc'
            ],
            'dongthap': [
                'TP. Cao Lãnh', 'TP. Sa Đéc', 'Thị xã Hồng Ngự', 'Cao Lãnh', 'Châu Thành', 'Hồng Ngự',
                'Lai Vung', 'Lấp Vò', 'Tam Nông', 'Tân Hồng', 'Thanh Bình', 'Tháp Mười'
            ],
            'gialai': [
                'TP. Pleiku', 'Thị xã An Khê', 'Thị xã Ayun Pa', 'Chư Păh', 'Chư Prông', 'Chư Sê',
                'Đăk Đoa', 'Đăk Pơ', 'Đức Cơ', 'Ia Grai', 'Ia Pa', 'KBang', 'Kông Chro', 'Krông Pa',
                'Mang Yang', 'Phú Thiện'
            ],
            'hagiang': [
                'TP. Hà Giang', 'Bắc Mê', 'Bắc Quang', 'Đồng Văn', 'Hoàng Su Phì', 'Mèo Vạc',
                'Quản Bạ', 'Quang Bình', 'Vị Xuyên', 'Xín Mần', 'Yên Minh'
            ],
            'hanam': [
                'TP. Phủ Lý', 'Thị xã Duy Tiên', 'Bình Lục', 'Kim Bảng', 'Lý Nhân', 'Thanh Liêm'
            ],
            'hatinh': [
                'TP. Hà Tĩnh', 'Thị xã Hồng Lĩnh', 'Thị xã Kỳ Anh', 'Cẩm Xuyên', 'Can Lộc', 'Đức Thọ',
                'Hương Khê', 'Hương Sơn', 'Kỳ Anh', 'Lộc Hà', 'Nghi Xuân', 'Thạch Hà', 'Vũ Quang'
            ],
            'haiduong': [
                'TP. Hải Dương', 'Thị xã Chí Linh', 'Bình Giang', 'Cẩm Giàng', 'Gia Lộc', 'Kim Thành',
                'Nam Sách', 'Ninh Giang', 'Thanh Hà', 'Thanh Miện', 'Tứ Kỳ'
            ],
            'hau giang': [
                'TP. Vị Thanh', 'Thị xã Long Mỹ', 'Thị xã Ngã Bảy', 'Châu Thành', 'Châu Thành A',
                'Long Mỹ', 'Phụng Hiệp', 'Vị Thủy'
            ],
            'hoabinh': [
                'TP. Hòa Bình', 'Cao Phong', 'Đà Bắc', 'Độc Lập', 'Kim Bôi', 'Kỳ Sơn', 'Lạc Sơn',
                'Lạc Thủy', 'Lương Sơn', 'Mai Châu', 'Tân Lạc', 'Yên Thủy'
            ],
            'hungyen': [
                'TP. Hưng Yên', 'Ân Thi', 'Khoái Châu', 'Kim Động', 'Mỹ Hào', 'Phù Cừ', 'Tiên Lữ',
                'Văn Giang', 'Văn Lâm', 'Yên Mỹ'
            ],
            'khanhhoa': [
                'TP. Nha Trang', 'TP. Cam Ranh', 'Thị xã Ninh Hòa', 'Cam Lâm', 'Diên Khánh', 'Khánh Sơn',
                'Khánh Vĩnh', 'Trường Sa', 'Vạn Ninh'
            ],
            'kiengiang': [
                'TP. Rạch Giá', 'TP. Hà Tiên', 'An Biên', 'An Minh', 'Châu Thành', 'Giang Thành',
                'Gò Quao', 'Hòn Đất', 'Kiên Hải', 'Kiên Lương', 'Phú Quốc', 'Tân Hiệp', 'U Minh Thượng',
                'Vĩnh Thuận'
            ],
            'kontum': [
                'TP. Kon Tum', 'Đắk Glei', 'Đắk Hà', 'Đắk Tô', 'Ia H\'Drai', 'Kon Plông', 'Kon Rẫy',
                'Ngọc Hồi', 'Sa Thầy', 'Tu Mơ Rông'
            ],
            'laichau': [
                'TP. Lai Châu', 'Mường Tè', 'Nậm Nhùn', 'Phong Thổ', 'Sìn Hồ', 'Tam Đường', 'Tân Uyên',
                'Than Uyên'
            ],
            'lamdong': [
                'TP. Đà Lạt', 'TP. Bảo Lộc', 'Cát Tiên', 'Đạ Huoai', 'Đạ Tẻh', 'Đam Rông', 'Di Linh',
                'Đơn Dương', 'Đức Trọng', 'Lạc Dương', 'Lâm Hà'
            ],
            'langson': [
                'TP. Lạng Sơn', 'Bắc Sơn', 'Bình Gia', 'Cao Lộc', 'Chi Lăng', 'Đình Lập', 'Hữu Lũng',
                'Lộc Bình', 'Tràng Định', 'Văn Lãng', 'Văn Quan'
            ],
            'laocai': [
                'TP. Lào Cai', 'Bắc Hà', 'Bảo Thắng', 'Bảo Yên', 'Bát Xát', 'Mường Khương', 'Sa Pa',
                'Si Ma Cai', 'Văn Bàn'
            ],
            'longan': [
                'TP. Tân An', 'Thị xã Kiến Tường', 'Bến Lức', 'Cần Đước', 'Cần Giuộc', 'Châu Thành',
                'Đức Hòa', 'Đức Huệ', 'Mộc Hóa', 'Tân Hưng', 'Tân Thạnh', 'Tân Trụ', 'Thạnh Hóa',
                'Thủ Thừa', 'Vĩnh Hưng'
            ],
            'namdinh': [
                'TP. Nam Định', 'Giao Thủy', 'Hải Hậu', 'Mỹ Lộc', 'Nam Trực', 'Nghĩa Hưng', 'Trực Ninh',
                'Vụ Bản', 'Xuân Trường', 'Ý Yên'
            ],
            'nghean': [
                'TP. Vinh', 'TP. Cửa Lò', 'Thị xã Hoàng Mai', 'Thị xã Thái Hòa', 'Anh Sơn', 'Con Cuông',
                'Diễn Châu', 'Đô Lương', 'Hưng Nguyên', 'Kỳ Sơn', 'Nam Đàn', 'Nghi Lộc', 'Nghĩa Đàn',
                'Quế Phong', 'Quỳ Châu', 'Quỳ Hợp', 'Quỳnh Lưu', 'Tân Kỳ', 'Thanh Chương', 'Tương Dương',
                'Yên Thành'
            ],
            'ninhbinh': [
                'TP. Ninh Bình', 'TP. Tam Điệp', 'Gia Viễn', 'Hoa Lư', 'Kim Sơn', 'Nho Quan', 'Yên Khánh',
                'Yên Mô'
            ],
            'ninhthuan': [
                'TP. Phan Rang - Tháp Chàm', 'Bác Ái', 'Ninh Hải', 'Ninh Phước', 'Ninh Sơn', 'Thuận Bắc',
                'Thuận Nam'
            ],
            'phutho': [
                'TP. Việt Trì', 'Thị xã Phú Thọ', 'Cẩm Khê', 'Đoan Hùng', 'Hạ Hòa', 'Lâm Thao',
                'Phù Ninh', 'Tam Nông', 'Tân Sơn', 'Thanh Ba', 'Thanh Sơn', 'Thanh Thủy', 'Yên Lập'
            ],
            'phuyen': [
                'TP. Tuy Hòa', 'Thị xã Sông Cầu', 'Đồng Xuân', 'Phú Hòa', 'Sơn Hòa', 'Sông Hinh',
                'Tây Hòa', 'Tuy An'
            ],
            'quangbinh': [
                'TP. Đồng Hới', 'Thị xã Ba Đồn', 'Bố Trạch', 'Lệ Thủy', 'Minh Hóa', 'Quảng Ninh',
                'Quảng Trạch', 'Tuyên Hóa'
            ],
            'quangnam': [
                'TP. Hội An', 'TP. Tam Kỳ', 'Thị xã Điện Bàn', 'Bắc Trà My', 'Đại Lộc', 'Đông Giang',
                'Duy Xuyên', 'Hiệp Đức', 'Nam Giang', 'Nam Trà My', 'Nông Sơn', 'Núi Thành', 'Phú Ninh',
                'Phước Sơn', 'Quế Sơn', 'Tây Giang', 'Thăng Bình', 'Tiên Phước'
            ],
            'quangngai': [
                'TP. Quảng Ngãi', 'Thị xã Đức Phổ', 'Ba Tơ', 'Bình Sơn', 'Lý Sơn', 'Minh Long',
                'Mộ Đức', 'Nghĩa Hành', 'Sơn Hà', 'Sơn Tây', 'Sơn Tịnh', 'Tây Trà', 'Trà Bồng',
                'Tư Nghĩa'
            ],
            'quangninh': [
                'TP. Hạ Long', 'TP. Móng Cái', 'TP. Uông Bí', 'Thị xã Cẩm Phả', 'Thị xã Quảng Yên',
                'Ba Chẽ', 'Bình Liêu', 'Cô Tô', 'Đầm Hà', 'Đông Triều', 'Hải Hà', 'Hoành Bồ', 'Tiên Yên',
                'Vân Đồn'
            ],
            'quangtri': [
                'TP. Đông Hà', 'Thị xã Quảng Trị', 'Cam Lộ', 'Cồn Cỏ', 'Đa Krông', 'Gio Linh',
                'Hải Lăng', 'Hướng Hóa', 'Triệu Phong', 'Vĩnh Linh'
            ],
            'soctrang': [
                'TP. Sóc Trăng', 'Thị xã Ngã Năm', 'Thị xã Vĩnh Châu', 'Châu Thành', 'Cù Lao Dung',
                'Kế Sách', 'Long Phú', 'Mỹ Tú', 'Mỹ Xuyên', 'Thạnh Trị', 'Trần Đề'
            ],
            'sonla': [
                'TP. Sơn La', 'Bắc Yên', 'Mai Sơn', 'Mộc Châu', 'Mường La', 'Phù Yên', 'Quỳnh Nhai',
                'Sông Mã', 'Sốp Cộp', 'Thuận Châu', 'Vân Hồ', 'Yên Châu'
            ],
            'tayninh': [
                'TP. Tây Ninh', 'Thị xã Hòa Thành', 'Thị xã Trảng Bàng', 'Bến Cầu', 'Châu Thành',
                'Dương Minh Châu', 'Gò Dầu', 'Tân Biên', 'Tân Châu'
            ],
            'thaibinh': [
                'TP. Thái Bình', 'Đông Hưng', 'Hưng Hà', 'Kiến Xương', 'Quỳnh Phụ', 'Thái Thụy',
                'Tiền Hải', 'Vũ Thư'
            ],
            'thainguyen': [
                'TP. Thái Nguyên', 'TP. Sông Công', 'Thị xã Phổ Yên', 'Đại Từ', 'Định Hóa', 'Đồng Hỷ',
                'Phú Bình', 'Phú Lương', 'Võ Nhai'
            ],
            'thanhhoa': [
                'TP. Thanh Hóa', 'TP. Sầm Sơn', 'Thị xã Bỉm Sơn', 'Thị xã Nghi Sơn', 'Bá Thước',
                'Cẩm Thủy', 'Đông Sơn', 'Hà Trung', 'Hậu Lộc', 'Hoằng Hóa', 'Lang Chánh', 'Mường Lát',
                'Nga Sơn', 'Ngọc Lặc', 'Như Thanh', 'Như Xuân', 'Nông Cống', 'Quan Hóa', 'Quan Sơn',
                'Quảng Xương', 'Thạch Thành', 'Thiệu Hóa', 'Thọ Xuân', 'Thường Xuân', 'Tĩnh Gia',
                'Triệu Sơn', 'Vĩnh Lộc', 'Yên Định'
            ],
            'thuathienhue': [
                'TP. Huế', 'TP. Hương Thủy', 'Thị xã Hương Trà', 'A Lưới', 'Nam Đông', 'Phong Điền',
                'Phú Lộc', 'Phú Vang', 'Quảng Điền'
            ],
            'tiengiang': [
                'TP. Mỹ Tho', 'TP. Gò Công', 'Thị xã Cai Lậy', 'Cái Bè', 'Cai Lậy', 'Châu Thành',
                'Chợ Gạo', 'Gò Công Đông', 'Gò Công Tây', 'Tân Phú Đông', 'Tân Phước'
            ],
            'travinh': [
                'TP. Trà Vinh', 'Càng Long', 'Cầu Kè', 'Cầu Ngang', 'Châu Thành', 'Duyên Hải',
                'Tiểu Cần', 'Trà Cú'
            ],
            'tuyenquang': [
                'TP. Tuyên Quang', 'Chiêm Hóa', 'Hàm Yên', 'Lâm Bình', 'Na Hang', 'Sơn Dương',
                'Yên Sơn'
            ],
            'vinhlong': [
                'TP. Vĩnh Long', 'Bình Minh', 'Bình Tân', 'Long Hồ', 'Mang Thít', 'Tam Bình',
                'Trà Ôn', 'Vũng Liêm'
            ],
            'vinhphuc': [
                'TP. Vĩnh Yên', 'Thị xã Phúc Yên', 'Bình Xuyên', 'Lập Thạch', 'Sông Lô', 'Tam Đảo',
                'Tam Dương', 'Vĩnh Tường'
            ],
            'yenbai': [
                'TP. Yên Bái', 'Thị xã Nghĩa Lộ', 'Lục Yên', 'Mù Căng Chải', 'Trạm Tấu', 'Trấn Yên',
                'Văn Chấn', 'Văn Yên', 'Yên Bình'
            ]
        };

        // Hàm cập nhật danh sách quận/huyện
        function updateDistricts() {
            const citySelect = document.getElementById('city');
            const districtSelect = document.getElementById('district');
            const selectedCity = citySelect.value;
            
            // Xóa tất cả options cũ
            districtSelect.innerHTML = '<option value="">Chọn quận/huyện</option>';
            
            if (!selectedCity) return;
            
            // Tìm trong provincesData, ưu tiên exact match
            let districts = provincesData[selectedCity];
            
            // Nếu không tìm thấy, thử normalize
            if (!districts) {
                const normalizedKey = selectedCity.toLowerCase().replace(/\s+/g, '').normalize('NFD').replace(/[\u0300-\u036f]/g, '').replace(/[đĐ]/g, 'd');
                districts = provincesData[normalizedKey];
            }
            
            if (districts) {
                districts.forEach(district => {
                    const option = document.createElement('option');
                    option.value = district; // Lưu tên đầy đủ có dấu
                    option.textContent = district;
                    districtSelect.appendChild(option);
                });
            }
        }

        // Khởi tạo trang khi load
        document.addEventListener('DOMContentLoaded', function() {
            console.log('Checkout page loaded');
            
            // Kiểm tra cart
            const cart = getCart();
            console.log('Cart items:', cart);
            
            // Debug: Log từng item để xem có ảnh không
            cart.forEach((item, index) => {
                console.log(`Item ${index}:`, {
                    id: item.id,
                    name: item.name,
                    price: item.price,
                    quantity: item.quantity,
                    image: item.image
                });
            });
            
            if (cart.length === 0) {
                // Nếu cart trống, chuyển về trang chủ
                showNotification('Giỏ hàng trống! Vui lòng thêm sản phẩm vào giỏ hàng.', 'warning');
                setTimeout(() => {
                    window.location.href = 'index.html';
                }, 2000);
                return;
            }
            
            // Hiển thị checkout form
            displayCheckoutForm();
            
            // Gắn sự kiện cho dropdown tỉnh/thành phố
            setTimeout(() => {
                const citySelect = document.getElementById('city');
                if (citySelect) {
                    citySelect.addEventListener('change', updateDistricts);
                }
            }, 100);
        });
    </script>
</body>
</html> 





